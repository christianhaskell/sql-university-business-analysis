{\rtf1\ansi\ansicpg1252\cocoartf2709
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 \
\'971CREATE OR REPLACE VIEW CustomerOrderSummary AS\
SELECT \
    c.customerNumber, \
    c.customerName, \
    IFNULL(COUNT(o.orderNumber), 0) AS totalOrders, \
    IFNULL(SUM(od.quantityOrdered * od.priceEach), 0) AS totalAmountSpent\
FROM customers c\
LEFT JOIN orders o ON c.customerNumber = o.customerNumber\
LEFT JOIN orderdetails od ON o.orderNumber = od.orderNumber\
GROUP BY c.customerNumber, c.customerName;\
\'97This view helps identify the top customers by total spending and is very useful for sales teams that might be trying to track customer engagement. It also makes sure that customers without orders still appear. \
\
\'972\
CREATE INDEX idx_lastName ON employees(lastName);\
\'97This speeds up searches for employees by last name. It is very useful for HR and management teams when they are searching employees.\
\
\'973\
-- Step 1: Create the audit table \
CREATE TABLE employee_audit (\
    auditID INT AUTO_INCREMENT PRIMARY KEY,\
    employeeNumber INT,\
    lastName VARCHAR(50),\
    firstName VARCHAR(50),\
    jobTitle VARCHAR(50),\
    email VARCHAR(100),\
    deletedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP\
);\
\
-- Step 2: Create the trigger\
DELIMITER //\
CREATE TRIGGER after_employee_delete\
AFTER DELETE ON employees\
FOR EACH ROW\
BEGIN\
    INSERT INTO employee_audit (employeeNumber, lastName, firstName, jobTitle, email)\
    VALUES (OLD.employeeNumber, OLD.lastName, OLD.firstName, OLD.jobTitle, OLD.email);\
END;\
//\
DELIMITER ;\
\
-- Step 3: Delete employees 1076 & 1143 (if they exist)\
DELETE FROM employees WHERE employeeNumber = 1076;\
DELETE FROM employees WHERE employeeNumber = 1143;\
\
-- Step 4: Verify if the deleted employees were logged\
SELECT * FROM employee_audit ORDER BY deletedAt DESC LIMIT 5;\
\
\'97Some foreign key restraints prevented the deletion of employees if they were linked to other tables. Another issue was after testing it one time, you couldn\'92t delete the same employee because they weren\'92t there so the audit table was empty. \
}